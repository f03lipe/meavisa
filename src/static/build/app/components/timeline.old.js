window.calcTimeFrom=function(t){var e=new Date,o=new Date(t),i=e-o;return 6e4>i?"agora":36e5>i?"h치 "+Math.floor(i/1e3/60)+"min":108e6>i?"h치 "+Math.floor(i/1e3/60/60)+"h":"h치 "+Math.floor(i/1e3/60/60/24)+" dias"},define(["jquery","backbone","underscore","bootstrap"],function(t,o,i){i.templateSettings={interpolate:/\<\@\=(.+?)\@\>/gim,evaluate:/\<\@([\s\S]+?)\@\>/gim,escape:/\<\@\-(.+?)\@\>/gim},setTimeout(function c(){t("[data-time-count]").each(function(){this.innerHTML=calcTimeFrom(parseInt(this.dataset.timeCount))}),setTimeout(c,1e3)},1e3),t('[data-action="send-post"]').click(function(){var e=document.querySelector("#inputPostContent").value;t.ajax({type:"post",dataType:"json",url:"/api/posts",data:{content:{body:e},groupId:window.groupId}}).done(function(t){document.querySelector("#inputPostContent").value="",app.postList.add(new n.item(t.data)),console.log("data",t.data)})});var n=function(){var e=o.View.extend({construction:function(t){this.collection=t.collection,o.View.apply(this,arguments)},destroy:function(){var t=this;this.model.destroy({success:function(){console.log("succes"),t.$el.removeData().unbind(),t.remove()}})}}),n=o.Model.extend({url:function(){return this.get("apiPath")}}),s=n.extend({}),a=e.extend({tagName:"li",className:"commentWrapper",template:i.template(t("#template-commentview").html()),initialize:function(){this.bindRemoveBtn()},bindRemoveBtn:function(){this.$el.on("click","[data-action=remove-post]",this.askForRemoval.bind(this))},askForRemoval:function(){confirm("Tem certeza que deseja excluir esse coment치rio?")&&this.destroy()},render:function(){return this.$el.html(this.template({comment:this.model.toJSON()})),this}}),c=o.Collection.extend({model:s,endDate:new Date,comparator:function(t){return 1*new Date(t.get("dateCreated"))},url:function(){return this.postItem.get("apiPath")+"/comments"},parse:function(t,e){return this.endDate=new Date(t.endDate),o.Collection.prototype.parse.call(this,t.data,e)},tryFetchMore:function(){console.log("tryFetchMore"),this.endDate!==new Date(0)&&this.fetch({data:{endDate:this.endDate},remove:!1})}}),l=o.View.extend({tagName:"ul",className:"commentListWrapper",_commentViews:[],initialize:function(){this.collection.on("reset",this.addAll,this),this.collection.on("add",this.addAll,this),this.addAll()},addAll:function(){var t=[];return this.collection.each(function(e){t.push(new a({model:e,collection:this.collection}))},this),this._commentViews=t,this.render()},render:function(){var t=document.createDocumentFragment();return i.each(this._commentViews,function(e){t.appendChild(e.render().el)},this),this.$el.empty(),this.$el.append(t),this},destroy:function(){this.remove()}}),r=n.extend({initialize:function(){this.commentList=new c(this.get("comments")),this.commentList.postItem=this.postItem}}),h=e.extend({tagName:"li",className:"postWrapper",template:i.template(t("#template-postview").html()),bindRemoveBtn:function(){this.$el.on("click",".opMessage [data-action=remove-post]",this.askForRemoval.bind(this))},askForRemoval:function(){confirm("Tem certeza que deseja excluir essa postagem?")&&this.destroy()},initialize:function(){this.model.collection.on("reset",this.destroy,this),this.bindRemoveBtn(),this.commentListView=new l({collection:this.model.commentList})},events:{"submit .formPostComment":function(e){console.log("this is",this,this.collection);var o=t(e.target).find(".commentInput"),i=this;t.ajax({type:"post",dataType:"json",url:this.model.get("apiPath")+"/comments",data:{content:{body:o.val()}}}).done(function(t){o.val(""),i.model.commentList.add(new s(t.data))})}},render:function(){return this.$el.html(this.template({post:this.model.toJSON()})),this.$el.find(".postCommentsSection").append(this.commentListView.$el),this}}),d=o.Collection.extend({model:r,url:function(){return app.postsRoot},page:0,comparator:function(t){return-1*new Date(t.get("dateCreated"))},parse:function(t,e){this.page=t.page;var n=o.Collection.prototype.parse.call(this,t.data,e);return i.filter(n,function(t){return!!t})},tryFetchMore:function(){-1!==this.page&&this.fetch({data:{page:this.page+1},remove:!1})}}),p=o.View.extend({className:"postListWrapper",_postViews:[],initialize:function(){this.collection.on("reset",this.addAll,this),this.collection.on("add",this.addAll,this)},addAll:function(){var t=[];return this.collection.each(function(e){t.push(new h({model:e,collection:this.collection}))},this),this._postViews=t,this.render()},render:function(){var t=document.createDocumentFragment();return i.each(this._postViews,function(e){t.appendChild(e.render().el)},this),this.$el.empty(),this.$el.append(t),this},destroy:function(){this.remove()}});return{item:r,list:d,view:h,listView:p}}(),s=o.sync;o.sync=function(t,o,n){if("patch"===t&&n.attrs instanceof Array){for(;e=n.attrs.pop();)n.attrs[e]=o.get(e);n.type="PUT",n.attrs=i.extend({},n.attrs)}return s(t,o,n)};var a=o.Router.extend({routes:{"posts/:postId":function(){console.log("post"),this.postList=new n.list,this.postListView=new n.listView({collection:this.postList}),this.postList.add(conf.postData),this.postListView.$el.appendTo(t("#postsPlacement"))},"labs/:labId":function(){console.log("lab"),window.conf.postsRoot&&(this.postsRoot=window.conf.postsRoot,this.labId=window.conf.labId,this.postList=new n.list,this.postListView=new n.listView({collection:this.postList}),this.postList.fetch({reset:!0}),this.postListView.$el.appendTo(t("#postsPlacement")))},"p/:profileId":"main","":"main"},initialize:function(){console.log("initialized"),window.app=this,t("#globalContainer").scroll(i.throttle(function(){t("#postsPlacement").height()-(t(window).height()+t("#posts-col").scrollTop())<200&&app.postList.tryFetchMore()},500))},main:function(){console.log("main",this),window.conf.postsRoot&&(this.postsRoot=window.conf.postsRoot,this.postList=new n.list,this.postListView=new n.listView({collection:this.postList}),this.postList.fetch({reset:!0}),this.postListView.$el.appendTo(t("#postsPlacement")))}});return{initialize:function(){new a,o.history.start({pushState:!1,hashChange:!1})}}});
//# sourceMappingURL=timeline.old.js.map