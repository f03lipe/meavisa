{% extends '../stdbody.html' %}
{% set dataPage="front" %}
{% set requirejsView=false %}

{% block pageTitle %}
QI Labs.org
{% endblock %}

{% import '../macros/metaTags.html' as metaTagMacros %}

{% block head %}
	{% block meta %}
	{{ metaTagMacros.facebook({
		title: "QILabs",
		description: 'Junte-se à lista de espera!'
	}) }}
	{{ metaTagMacros.meta({
		title: "QILabs",
		description: 'Junte-se à lista de espera!'
	}) }}
	{{ metaTagMacros.twitter({
		title: "QILabs",
		description: "Junte-se à lista de espera!",
	}) }}
	{% endblock %}
	<link rel="stylesheet" href="{{ getMediaUrl('css/snpages.min.css') }}" />
{% endblock %}

{% block body %}
	<div class="screen">
		<div id="wallterfall">
			<div class="wall grid">
				<div class="cardView">
					<i></i>
				</div>
			</div>
			<script>
				(function () {
					var icons = ['icon-exclamation', 'icon-trophy', 'icon-question', 'icon-comments-o', 'icon-guide', 'icon-puzzle', 'icon-rocket','icon-compass','icon-bulb','icon-flask','icon-sum','icon-university','icon-cap']
					var cv = document.querySelector(".cardView"),
						cc = document.querySelector(".wall");
					var manyW = Math.floor((window.innerWidth+300)/(234+30)), manyH = Math.floor(window.innerHeight/200);
					for (var i=0; i<(manyW*5-1)+((manyH+1)*manyW); i++) {
						var nc = cv.cloneNode(true);
						if (Math.random() > 0.50) {
							var icon = icons[Math.floor(Math.random()*icons.length)];
							nc.querySelector('i').className += ' '+icon;
						}
						cc.appendChild(nc);
					}
				})();
			</script>
		</div>
	</div>

	<div class="blackout"></div>

	<section class="jumbo">
		<div class="top">
			<a href="/" class="us">
				<i class="icon-bulb"></i>
			</a>
			<div class="message">
				Junte-se à lista de espera
			</div>
		</div>
		<div class="board">
			<form onSubmit="return false">
				<label>Seu nome</label>
				<input type="text" name="name" />
				<div class="bubble" id="nameBubble"></div>
				<label>Seu email</label>
				<div class="bubble" id="emailBubble"></div>
				<input type="email" name="email" />
				<input type="hidden" name="_csrf" value="{{ token }}" />
				<button disabled data-action="send-form">Solicitar convite</button>
			</form>
			<div id="abientot">
				<h1>Pedido processado! :)</h1>
				<h2>Nos falaremos em breve.</h2>
				<div class="me">– Felipe</div>
			</div>
		</div>
		<div class="footer">
			QI Labs.org, 2014
		</div>
	</section>

<script src="/static/js/vendor/jquery-2.0.3.min.js"></script>
<script src="/static/js/vendor/modernizr-2.6.2.min.js"></script>
<script src="/static/js/vendor/bootstrap/tooltip.js"></script>
<script>
$("body").tooltip({selector:'[data-toggle=tooltip]'});
(function setCSRFToken () {
	$.ajaxPrefilter(function(options, _, xhr) {
		if (!options.crossDomain) {
			xhr.setRequestHeader('X-CSRF-Token',
				$("meta[name='csrf-token']").attr('content'));
		}
	});
})();
$("[name=email], [name=name]").on('keypress keyup focusout change', function () {
	var email = document.querySelector('form [name=email]').value.replace(/^\s+|\s+$/g, ''),
		name = document.querySelector('form [name=name]').value.replace(/^\s+|\s+$/g, '');

	if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
		if (/\w{3,}/.test(name)) {
			document.querySelector("[data-action=send-form]").disabled = false;
		} else {
			document.querySelector("[data-action=send-form]").disabled = true;
		}
	} else {
		document.querySelector("[data-action=send-form]").disabled = true;
	}
});
$(".bubble, #bubbleMaster").click(function () {
	$(this).fadeOut();
});
$("[data-action=send-form]").click(function () {
	var email = document.querySelector('form [name=email]').value.replace(/^\s+|\s+$/g, ''),
		name = document.querySelector('form [name=name]').value.replace(/^\s+|\s+$/g, '');
	$.ajax({
		type: 'POST',
		url: '/waitlist',
		dataType: 'json',
		data: { email: email, name: name }
	}).done(function (response) {
		if (response.error == false) {
			$('form').slideUp(function () {
				$("#abientot").slideDown();
			});
		} else {
			if (response.field == 'email') {
				$("#emailBubble").html(response.message).fadeIn();
				$("[name=email]").addClass('invalid');
				$("[name=email]").one('keypress keyup', function () {
					$(this).removeClass('invalid');
				});
			} else if (response.field == 'name') {
				$("#nameBubble").html(response.message).fadeIn();
				$("[name=name]").addClass('invalid');
				$("[name=name]").one('keypress keyup', function () {
					$(this).removeClass('invalid');
				});
			} else if (response.message) {
				$("#bubbleMaster").html(response.message).fadeIn();
			}
		}
	}).fail(function () {
		$("#bubbleMaster").html("Ops! Erro no servidor.").fadeIn();	
	});
});
</script>

{% endblock %}